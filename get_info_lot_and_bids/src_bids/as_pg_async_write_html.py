import datetime
import logging
import sys
import time

import asyncpg

from config import settings
from get_info_lot_and_bids.src_bids import models_bids
from get_info_lot_and_bids.src_bids.database_conf import engine_bids, SessionBids
from get_info_lot_and_bids.src_bids.models_bids import HtmlStr
from note_finally_parser import push_note_mail

logging.basicConfig(level=logging.WARNING, filename="log_async.log", filemode="a")


async def add_html_str_pg_asyncpg(data, type_work="asyncpg") -> None:
    """
    Функция для записи в базу данных
    Имеет два режима работы
    sqllite3 - служит для быстрого запуска кода(теряется скорость загрузки данных)
    asyncpg - служит для быстрой радоты кода(требуется устновка на комп postgresql)
    :param data: список словарей [{"response_text": str,  "id_lot": int, "id_auction": int}, {}]
    :param type_work: <sqllite3> | <asyncpg>
    :return: None
    """
    try:
        if type_work == "sqllite3":
            models_bids.BaseBids.metadata.create_all(bind=engine_bids)
            list_data_for_insert = []
            for tuple_item in data:
                dict_data_in_db = {
                    "html": tuple_item[0],
                    "id_lot_hidden": tuple_item[1],
                    "id_auction_hidden": tuple_item[2],
                }
                list_data_for_insert.append(dict_data_in_db)
            with SessionBids() as session:
                session.bulk_insert_mappings(HtmlStr, list_data_for_insert)
                session.commit()
        elif type_work == "asyncpg":
            conn = await asyncpg.connect(settings.SQLALCHEMY_DATABASE_URL_POSTGRES)
            await conn.executemany('''
                        INSERT INTO (html, id_lot_hidden, id_auction_hidden) VALUES($1, $2, $3)
                    ''', data)

            await conn.close()
        else:
            print("Такого типа работы не существует")
            sys.exit()
    except Exception as e:
        date_wrong = datetime.datetime.now()
        logging.error(f"[{date_wrong}]"
                      f"Проблема c записью в бд: {e}"
                      f"===============================================")
        push_note_mail(email_text=f"Упала ошибка. Проблема с записью в бд {e}",
                       subject_email="Проблема с бд")
        print(f"{e}"
              "Уходит в сон. остановилось в бд")
        sys.exit()


# a = [{
#     'html': '\n\t<table class="colored" width="100%">\n\t\t<tr>\n\t\t\t<th>Сумма</th>\n\t\t\t<th></th>\n\t\t\t<th>Логин</th>\n\t\t\t<th nowrap style="text-align: right;">Дата / Время</th>\n\t\t\t<th width="100%"></th>\n\t\t</tr>\n\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>1 180</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 13:05:57</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>1 151</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 13:05:57</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>1 122</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 09:32:17</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>1 094</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 09:32:17</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>971</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 06:52:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>947</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 06:52:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>923</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">18.06.2024 20:05:49</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>900</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">18.06.2024 20:05:49</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>820</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">16.06.2024 00:23:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>800</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">16.06.2024 00:23:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>342</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 22:36:07</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>333</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 22:36:07</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>324</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 21:25:00</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>316</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 21:25:00</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>308</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 01:45:36</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t</table>\n\n\t\t<script>\n\t\tlast_bid_id = 172036;\n\n\t\t$(\'#sum\').html(\'1 180\');\n\t\t$(\'#min_bid\').html(\'1 210\');\n\n\t\t$(\'#bid input[name=value]\').each(function() {\n\t\t\tif ($(this).is(\':focus\')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldVal = parseInt($(this).data(\'value\'), 10);\n\t\t\tvar val = parseInt($(this).val(), 10);\n\t\t\tif (isNaN(val)) {\n\t\t\t\tval = 0;\n\t\t\t}\n\t\t\tif (oldVal !== val) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar val2 = parseInt(\'1210\', 10);\n\t\t\tif (val2 > val) {\n\t\t\t\t$(this).val(val2);\n\t\t\t\t$(this).data(\'value\', val2);\n\t\t\t}\n\t\t});\n\t</script>\n',
#     'id_lot_hidden': 6770811, 'id_auction_hidden': 1987}, {
#     'html': '\n\t<table class="colored" width="100%">\n\t\t<tr>\n\t\t\t<th>Сумма</th>\n\t\t\t<th></th>\n\t\t\t<th>Логин</th>\n\t\t\t<th nowrap style="text-align: right;">Дата / Время</th>\n\t\t\t<th width="100%"></th>\n\t\t</tr>\n\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>1 180</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 13:05:57</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>1 151</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 13:05:57</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>1 122</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 09:32:17</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>1 094</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 09:32:17</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>971</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 06:52:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>947</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 06:52:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>923</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">18.06.2024 20:05:49</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>900</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">18.06.2024 20:05:49</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>820</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">16.06.2024 00:23:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>800</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">16.06.2024 00:23:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>342</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 22:36:07</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>333</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 22:36:07</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>324</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 21:25:00</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>316</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 21:25:00</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>308</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 01:45:36</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t</table>\n\n\t\t<script>\n\t\tlast_bid_id = 172036;\n\n\t\t$(\'#sum\').html(\'1 180\');\n\t\t$(\'#min_bid\').html(\'1 210\');\n\n\t\t$(\'#bid input[name=value]\').each(function() {\n\t\t\tif ($(this).is(\':focus\')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldVal = parseInt($(this).data(\'value\'), 10);\n\t\t\tvar val = parseInt($(this).val(), 10);\n\t\t\tif (isNaN(val)) {\n\t\t\t\tval = 0;\n\t\t\t}\n\t\t\tif (oldVal !== val) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar val2 = parseInt(\'1210\', 10);\n\t\t\tif (val2 > val) {\n\t\t\t\t$(this).val(val2);\n\t\t\t\t$(this).data(\'value\', val2);\n\t\t\t}\n\t\t});\n\t</script>\n',
#     'id_lot_hidden': 6770811, 'id_auction_hidden': 1987}, {
#     'html': '\n\t<table class="colored" width="100%">\n\t\t<tr>\n\t\t\t<th>Сумма</th>\n\t\t\t<th></th>\n\t\t\t<th>Логин</th>\n\t\t\t<th nowrap style="text-align: right;">Дата / Время</th>\n\t\t\t<th width="100%"></th>\n\t\t</tr>\n\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>1 180</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 13:05:57</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>1 151</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 13:05:57</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>1 122</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 09:32:17</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>1 094</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 09:32:17</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>971</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 06:52:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>947</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">19.06.2024 06:52:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>923</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">18.06.2024 20:05:49</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>900</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">18.06.2024 20:05:49</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>820</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">16.06.2024 00:23:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>800</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">16.06.2024 00:23:18</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>342</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 22:36:07</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>333</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 22:36:07</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>324</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 21:25:00</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="row2">\n\t\t\t\t<td nowrap>316</td>\n\t\t\t\t<td style="padding-right: 30px;"></td>\n\t\t\t\t<td nowrap >sanfic</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 21:25:00</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr class="">\n\t\t\t\t<td nowrap>308</td>\n\t\t\t\t<td style="padding-right: 30px;">*</td>\n\t\t\t\t<td nowrap >artemVologda</td>\n\t\t\t\t<td nowrap style="padding-left: 30px;">15.06.2024 01:45:36</td>\n\t\t\t\t<td width="100%"></td>\n\t\t\t</tr>\n\t\t\t</table>\n\n\t\t<script>\n\t\tlast_bid_id = 172036;\n\n\t\t$(\'#sum\').html(\'1 180\');\n\t\t$(\'#min_bid\').html(\'1 210\');\n\n\t\t$(\'#bid input[name=value]\').each(function() {\n\t\t\tif ($(this).is(\':focus\')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldVal = parseInt($(this).data(\'value\'), 10);\n\t\t\tvar val = parseInt($(this).val(), 10);\n\t\t\tif (isNaN(val)) {\n\t\t\t\tval = 0;\n\t\t\t}\n\t\t\tif (oldVal !== val) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar val2 = parseInt(\'1210\', 10);\n\t\t\tif (val2 > val) {\n\t\t\t\t$(this).val(val2);\n\t\t\t\t$(this).data(\'value\', val2);\n\t\t\t}\n\t\t});\n\t</script>\n',
#     'id_lot_hidden': 6770812, 'id_auction_hidden': 1987}]
# b = [('\n\t<table class="colored" width="100%">\n\t\t<tr>\n\t\t\t<th>Сумм', 123, 123), ('\n\t<table class="colored" width="100%">\n\t\t<tr>\n\t\t\t<th>Сумм', 123, 123)]
# with SessionBids() as session:
#     session.bulk_insert_mappings(HtmlStr, b)
#     session.commit()
# html id_lot_hidden